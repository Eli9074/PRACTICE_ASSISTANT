@if (audioPlayer.isLoading()) {
  <div class="loading-overlay">
    <div class="spinner"></div>
  </div>
}

<div class="flex-grow-1 pt-4">
  <div id="transcription-page" class="container card-glass card shadow-lg h-100 d-flex rounded-4">

    <!-- Left Column -->
    <div class="d-flex flex-50 flex-column">
      <div class="flex-grow-1 align-items-center">

        <!-- Current Song Title -->
        @if(currentSong()) {
          <h3 class="text-center pt-5 pb-3 mb-0">
            {{ currentSong()?.title }} - {{ currentSong()?.artist }}
          </h3>
        }

        <!-- Main Scrubber -->
        <div class="scrubber-wrapper px-5 py-3">
          <div #playheadScrubber
               class="scrubber"
               (mousedown)="startDrag('playhead', $event)"
               (click)="seekTimeline($event)">

            <!-- Scrubber Fill & Thumb -->
            <div class="scrubber-fill"
                 [style.left.%]="0"
                 [style.width.%]="playheadPercent">
            </div>

            <div class="scrubber-thumb" [style.left.%]="playheadPercent"></div>
          </div>
        </div>

        <!-- Audio Controls -->
        <div id="audio-controls-container" class="d-flex justify-content-center gap-4 py-3">
          <button class="btn btn-lg btn-dark audio-btn" (click)="audioPlayer.restart()">
            <i class="bi-skip-start-btn"></i>
          </button>
          <button class="btn btn-lg btn-dark audio-btn" (click)="audioPlayer.play()">
            <i class="bi-play-btn"></i>
          </button>
          <button class="btn btn-lg btn-dark audio-btn" (click)="audioPlayer.pause()">
            <i class="bi-pause-btn"></i>
          </button>
        </div>

        <!-- Stems Buttons -->
        <div class="card rounded-4 py-3 mx-3 mt-3">
          <div id="stems-container" class="d-flex justify-content-around gap-4">
            <button class="btn btn-lg btn-dark audio-btn"><i class="bi-mic"></i></button>
            <button class="btn btn-lg btn-dark audio-btn"><i class="bi-music-note"></i></button>
            <button class="btn btn-lg btn-dark audio-btn"><i class="bi-music-note"></i></button>
            <button class="btn btn-lg btn-dark audio-btn"><i class="bi-music-note"></i></button>
            <button class="btn btn-lg btn-dark audio-btn"><i class="bi-music-note"></i></button>
          </div>
        </div>

      </div>
    </div>

    <!-- Right Column -->
    <div class="d-flex flex-50">

      <!-- Looping Card -->
      <div class="d-flex flex-50 p-3">
        <div class="card flex-grow-1 rounded-4">
          <div class="card-header bg-dark rounded-top-4 d-flex align-items-center justify-content-between">
            <div></div>
            <h3 class="text-white mb-0 text-center flex-grow-1">Looping</h3>
            <div class="form-check form-switch text-white">
              <input class="form-check-input" type="checkbox"
                     id="loopingEnabled"/>
            </div>
          </div>

          <div class="card-body d-flex flex-column">
            <div class="flex-50">
              <h3 class="text-center">Start</h3>
              <div class="d-flex justify-content-center">
                <input type="text" class="form-control">

              </div>
            </div>
            <div class="flex-50">
              <h3 class="text-center">Stop</h3>
              <div class="d-flex justify-content-center">
                <input type="text" class="form-control">

              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Speed & Sensitivity Card -->
      <div class="d-flex flex-50 p-3">
        <div class="card flex-grow-1 rounded-4">
          <h3 class="text-center pt-3">Speed</h3>
          <div class="d-flex justify-content-center mx-5">
            <input type="text" class="form-control" placeholder="Enter speed (0.25-2)" #speedinput (keydown.enter)="onStretchEnter(speedinput.value)">
          </div>

          <h3 class="text-center pt-3">Sensitivity</h3>
          <div class="scrubber-wrapper px-5 py-3">
<!--            <div class="scrubber" #scrubber data-index="2"-->
<!--                 (click)="seek($event, 2)"-->
<!--                 (mousedown)="startDrag($event, 2)">-->
<!--              <div class="scrubber-fill" [style.width.%]="progress[2]"></div>-->
<!--              <div class="scrubber-thumb" [style.left.%]="progress[2]"></div>-->
<!--            </div>-->
          </div>

          <div class="d-flex justify-content-center">
            <button class="btn btn-dark my-4">Reload Stems</button>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>
